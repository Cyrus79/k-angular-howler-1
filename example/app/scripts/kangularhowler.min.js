"use strict";angular.module("kAngularHowlerApp",[]),angular.module("kAngularHowlerApp").controller("AudioCtrl",["$document","$scope","$timeout","$interval",function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q=this;q.data={startIcon:"fa fa-play",stopIcon:"stop",pauseIcon:"fa fa-pause",volumeUp:"fa fa-volume-up",volumeDown:"fa fa-volume-down",volumeOff:"fa fa-volume-off"},n=function(){d.cancel(l),p&&Howler.unload()},j=function(a){return a>.5?q.data.volumeUp:.5>=a&&a>0?q.data.volumeDown:q.data.volumeOff},e=function(){f=!1,q.playIcon=q.data.startIcon,d.cancel(l)};var r=function(a){q.playlist=a.slice(0)};r.prototype={play:function(a){var c=q.playlist;if(!(0>a||!c||0===!c.length||a>=c.length)){var g;a="number"==typeof a?a:0;var h=c[a];return h.howl?g=h.howl:(g=h.howl=new Howl({src:h.src,volume:q.volume,html5:!0,onplay:function(a){q.duration=h.howl.duration(),f=!0,q.playIcon=q.data.pauseIcon,q.showSoundInfo=!0,q.showSpinner=!1,q.showError=!1,l=d(k,500)},onload:function(){p.loaded=!0},onloaderror:function(a){q.showError=!0,q.showSpinner=!1,b.$apply()},onend:function(){e(),b.$apply()},onpause:function(){e(),b.$apply()},onstop:function(){b.$apply()},onseek:function(){d.cancel(l),l=d(k,500)}}),p=g),q.image=h.image,q.username=h.username,q.filename=h.filename,q.userId=h.userId,q.userProfileLink=h.userProfileLink,g.play()}},pause:function(a,b){var c=q.playlist;c[a]&&c[a].howl&&c[a].howl.pause(b)},stop:function(a,b){var c=q.playlist;try{c&&c[a].howl&&q.playlist[a].howl.stop(b)}catch(d){}},volumeChange:function(a,b){var c=q.playlist;c[a]&&c[a].howl&&(c[a].howl.volume(b),q.volumeIcon=j(b))},seek:function(a,b,c){var d=q.playlist;return d[a]&&d[a].howl?c?d[a].howl.seek(c,b):d[a].howl.seek(b):void 0}},i=function(){b.playlist&&b.playlist.length>0&&(n(),q.triggerElm=b.triggerElm,f=!1,q.volume=b.volume||.4,q.playbackPosition=0,q.duration=0,q.startOffset=0,q.showSoundInfo=!1,q.showSpinner=!1,q.showError=!1,q.showVolumeLevel=!1,q.thisIsVolumeRange=!1,q.volumeIcon=j(q.volume),q.volumeLevel=30,q.playIcon=q.data.startIcon,q.playlist=b.playlist,q.autoPlay="boolean"==typeof b.autoPlay?b.autoPlay:!1,q.hideAtStateChange="boolean"==typeof b.hideAtStateChange?b.hideAtStateChange:!0,b.index&&b.index>0&&b.index<q.playlist.length?q.index=b.index:q.index=0,g=new r(b.playlist),q.autoPlay&&q.play())},k=function(){q.startOffset=g.seek(q.index,q.soundId)||0,q.playbackPosition=100*q.startOffset/q.duration},q.volumeChange=function(){g.volumeChange(q.index,q.volumeLevel/100)},q.timeChange=function(){try{d.cancel(l),q.startOffset=q.playbackPosition*q.duration/100,g.seek(q.index,q.soundId,q.startOffset)}catch(a){}},q.play=function(){f?g.pause(q.index,q.soundId):(q.showSpinner=!0,q.showError=!1,q.soundId=g.play(q.index))},q.move=function(a){var b="backward"===a?q.index-1||0:q.index+1;b>=0&&b<g.playlist.length&&(q.showSoundInfo=!1,g.stop(q.index),f=!1,q.index=b,q.play())},q.hideVolume=function(){q.showVolumeLevel=!1,q.thisIsVolumeRange=!1},q.showVolume=function(){q.thisIsVolumeRange||(q.showVolumeLevel=!q.showVolumeLevel),q.thisIsVolumeRange=!1},q.close=function(){n(),b.playlist=null},h=b.$on("sonic-audio-show",function(a,c){b.playlist=c.playlist,b.index=c.index,b.autoPlay=c.autoPlay,b.hideAtStateChange=c.hideAtStateChange,q.currentSource&&q.currentSource===q.playlist[q.index].src[0]?q.play():(q.currentSource=q.playlist[q.index].src[0],i())}),o=b.$on("sonic-audio-pause-current",function(){q.play()}),m=b.$on("$stateChangeStart",function(){q.hideAtStateChange&&h()}),b.$on("$destroy",function(){"function"==typeof h&&h(),"function"==typeof m&&m(),"function"==typeof o&&o()}),i()}]),angular.module("kAngularHowlerApp").directive("sonicAudio",[function(){return{templateUrl:"views/audio.html",controller:"AudioCtrl as audioCtrl",restrict:"E",replace:!0,scope:{playlist:"=?",autoPlay:"=?",hideAtStateChange:"=?",index:"=?",triggerElm:"@"},link:function(a,b,c){}}}]),angular.module("kAngularHowlerApp").filter("secondsToDateTime",[function(){return function(a){return new Date(1970,0,1).setSeconds(a)}}]),angular.module("kAngularHowlerApp").run(["$templateCache",function(a){a.put("views/audio.html",'<div class="sonic-audio-player-wrapper"> <div class="sonic-audio-player-base"></div> <!--<div class="sonic-audio-player-cover">--> <div class="sonic-audio-player"> <div class="sap-section"> <i class="sap-icon fa fa-step-backward" ng-click="audioCtrl.move(\'backward\')"></i> <i class="sap-icon {{audioCtrl.playIcon}}" ng-click="audioCtrl.play()"></i> <i class="sap-icon fa fa-step-forward" ng-click="audioCtrl.move()"></i> <!--<i class="sap-icon fa fa-stop" ng-click="audioCtrl.stop()"></i>--> <span class="sap-icon spn-icon-volume {{audioCtrl.volumeIcon}}" ng-click="audioCtrl.showVolume(this)" ng-mouseleave="audioCtrl.showVolumeLevel = false" asc-click-anywhere-but-here="audioCtrl.hideVolume()" stop-event="click"> <!--<span class="volume-level" ng-if="audioCtrl.showVolumeLevel">--> <input class="volume-level" type="range" class="level" ng-if="audioCtrl.showVolumeLevel" ng-click="audioCtrl.thisIsVolumeRange = true;" ng-change="audioCtrl.volumeChange()" ng-model="audioCtrl.volumeLevel"> </span> <!--</span>--> <span class="sap-spinner-icon-cover" ng-show="audioCtrl.showSpinner"> <span class="fa fa-cog fa-spin sap-spinner-icon"></span> </span> <span class="sap-info" ng-show="audioCtrl.showSoundInfo"> <img class="sap-info-image" src="{{audioCtrl.accountImage}}"> <span class="sap-name"> <span class="sap-info-user-name" ng-bind="audioCtrl.username"></span> <span class="sap-info-file-name"> {{audioCtrl.filename}} <span class="progressbar"> <span ng-show="audioCtrl.startOffset" class="sonic-audio-player-meter sonic-audio-player-meter-left"> {{ audioCtrl.startOffset | secondsToDateTime | date:\'mm:ss\'}}</span> <input class="progressbar-input" id="progressBar" type="range" ng-change="audioCtrl.timeChange()" ng-model="audioCtrl.playbackPosition"> <span class="sonic-audio-player-meter sonic-audio-player-meter-right"> {{ audioCtrl.duration | secondsToDateTime | date:\'mm:ss\'}}</span> </span> </span> </span> </span> </div><!--audio-player-first-section--> </div> <!--</div><!-sonic-audio-player-cover&ndash;&gt;--> </div><!--sonic-audio-player-wrapper-->')}]);